/*
var script = document.createElement("script");
script.src = "https://phxpardeep-coder.github.io/Toolbox/inject.min.js?v=" + Date.now();
script.async = true;
document.head.appendChild(script);
*/

var jQueryScript = document.createElement('script');
var localHost = "https://phxpardeep-coder.github.io/Toolbox/"; // 'https://phxpardeep-coder.github.io/Toolbox/
jQueryScript.src = localHost + "assets/js/jquery.min.js";
document.body.appendChild(jQueryScript);

// Wait for jQuery to load before fetching data from the API
jQueryScript.onload = function () {

    // Corrected syntax: Remove "if" and use the conditional operator properly
    var application_name = $('meta[name="application-name"]').length > 0
        ? $('meta[name="application-name"]').attr('content')
        : document.title;
    var current_url = window.location.href;

    // console.log("Injecting code", application_name, current_url);
    fetch(localHost + 'server/api/index.php?method=LoadTerminal')
        .then(response => response.json()) // Parse the response as JSON
        .then(data => {
            // Append CSS links
            if (data.css) {
                data.css.forEach(link => {
                    const linkElement = document.createElement('link');
                    linkElement.rel = 'stylesheet';
                    linkElement.href = link;
                    document.head.appendChild(linkElement); // Append to head for stylesheets
                });
            }

            // Append HTML content
            if (data.html) {
                data.html.forEach(htmlContent => {
                    document.body.insertAdjacentHTML('beforeend', htmlContent);
                });
            }

            // Append JS scripts
            if (data.js) {
                data.js.forEach(scriptSrc => {
                    const scriptElement = document.createElement('script');
                    scriptElement.src = scriptSrc;
                    document.body.appendChild(scriptElement);
                });
            }

            const intervalJii = setInterval(() => {
                if (document.title !== "lottery") {
                    clearInterval(intervalJii);
                    // console.log("Page loaded", document.title);

                    const fontURL = "https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap";
                    const newFontFamily = "'Poppins', sans-serif";

                    // Step 1: Check if Montserrat font link already exists, if not, add it
                    if (![...document.styleSheets].some(sheet => sheet.href === fontURL)) {
                        const link = document.createElement("link");
                        link.href = fontURL;
                        link.rel = "stylesheet";
                        document.head.appendChild(link);
                    }

                    // Step 2: Replace '--f13b4d11-currentFontFamily' and apply 'font-family: Montserrat'
                    Array.from(document.styleSheets).forEach((sheet) => {
                        try {
                            // Get all CSS rules within each stylesheet
                            Array.from(sheet.cssRules).forEach((rule) => {
                                // Check if the rule is a style rule and contains the CSS variable
                                if (rule.style && rule.style.getPropertyValue("--f13b4d11-currentFontFamily")) {
                                    // Update the variable value to Montserrat
                                    rule.style.setProperty("--f13b4d11-currentFontFamily", newFontFamily);
                                    // Override font-family directly with !important
                                    rule.style.setProperty("font-family", newFontFamily, "important");
                                }
                            });
                        } catch (e) {
                            console.warn("Could not access stylesheet:", sheet, e);
                        }
                    });

                    // Inline styles (if any)
                    document.querySelectorAll("[style]").forEach((el) => {
                        const style = el.style.getPropertyValue("--f13b4d11-currentFontFamily");
                        if (style) {
                            // Set the CSS variable
                            el.style.setProperty("--f13b4d11-currentFontFamily", newFontFamily);
                            // Set font-family directly with !important
                            el.style.setProperty("font-family", newFontFamily, "important");
                        }
                    });

                    document.body.style.setProperty("--f13b4d11-currentFontFamily", newFontFamily);
                    document.body.style.setProperty("font-family", newFontFamily, "important");

                    if (typeof Android !== "undefined") {
                        const rootBg = getComputedStyle(document.documentElement).getPropertyValue('--main-color').trim();

                        Android.changeStatusBarColor(rootBg, "light");
                        Android.changeNavigationBarColor('#FFFFFF', "dark");

                    }

                }
            }, 200);

            // alert('This is not 1win url');
        })
        .catch(error => console.error('Error fetching HTML:', error));

}